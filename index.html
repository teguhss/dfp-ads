<html>

<head>
  <title>IMA HTML5 Simple Demo</title>
  <script async='async' src='https://www.googletagservices.com/tag/js/gpt.js'></script>
  <script>
    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];
  </script>

  <script>
    googletag.cmd.push(function () {
      googletag.defineSlot('/136715487/freesky_test_front_end', [640, 480], 'div-gpt-ad-1549247937849-0').addService(googletag.pubads());
      googletag.pubads().enableSingleRequest();
      googletag.enableServices();
    });
  </script>
</head>

<body>
  <h1>This is Your Content</h1>
  <!-- /136715487/freesky_test_front_end -->
  <div id="interstitial" style="background-color: black; position: absolute;
        z-index: 100; height: 100%; width: 100%; top: 0; left: 0;
        display: flex; flex-direction: column; justify-content: center; align-items: center;">
    <div id='div-gpt-ad-1549247937849-0' style='height:480px; width:640px;'>
      <script>
        window.addEventListener('message', function (event) {
          var data = event.data;
          if (data.type && data.type === 'adMessage') {
            console.log(event.data);
            document.getElementById('interstitial').style.display = 'none';
          }
        });

        googletag.cmd.push(function () { googletag.display('div-gpt-ad-1549247937849-0'); });
        var iframe = null;
        var checkIframe = setInterval(function () {
          var adsDiv = document.getElementById('div-gpt-ad-1549247937849-0');
          iframe = adsDiv.getElementsByTagName('iframe');
          if (iframe && iframe[0]) {
            iframe = iframe[0];
            iframe.style.width = iframe.style.height = '100%';
            console.log(iframe);
            try {
              var innerDoc = (iframe.contentDocument)
                ? iframe.contentDocument
                : iframe.contentWindow.document;
              var video = innerDoc.getElementsByTagName('video');
              if (video && video[0]) {
                video = video[0];
                console.log(video);
                video.muted = true;
                video.play();
                video.addEventListener('ended', function () {
                  console.log('Video Ended Detected');
                  document.getElementById('interstitial').style.display = 'none';
                }, false);
                clearInterval(checkIframe);
              }
            } catch (err) {
              console.log(err.toString());
              if (err.toString().includes('Blocked a frame with origin')) {
                clearInterval(checkIframe);
              }
            }
          }
        }, 500);
      </script>
    </div>
  </div>
</body>

</html>
